AWSTemplateFormatVersion: "2010-09-09"
Description: Security groups. Built from a Production Pipeline.
Parameters:
  Namespace:
    Description: Prefix for all resources generated by the pipeline
    Type: String
  VpcId:
    Description: VPC ID to build in
    Type: String

Resources:
  ContainerSecurityGroup:
    Type: "AWS::EC2::SecurityGroup"
    Properties:
      SecurityGroupEgress:
        - CidrIp: 0.0.0.0/0
          IpProtocol: "-1"
          Description: Allows Egress to the world
      VpcId: !Ref VpcId
      GroupDescription: !Sub "${Namespace} ECS SecurityGroup"

  ServerlessSecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Security group for lambda
      SecurityGroupEgress:
        - CidrIp: 0.0.0.0/0
          IpProtocol: "-1"
          Description: Allows Egress to the world
      VpcId: !Ref VpcId

  VPCESecurityGroup:
    Type: AWS::EC2::SecurityGroup
    Properties:
      GroupDescription: Security group for vpc endpoint
      SecurityGroupIngress:
        - IpProtocol: tcp
          CidrIp: 0.0.0.0/0
          FromPort: 443
          ToPort: 443
          Description: Allow ingress on 443
      SecurityGroupEgress:
        - IpProtocol: -1
          CidrIp: 0.0.0.0/0
          Description: Allows Egress to the world
      VpcId: !Ref VpcId

Outputs:
  ContainerSecurityGroup:
    Value: !Ref ContainerSecurityGroup
  ServerlessSecurityGroup:
    Value: !Ref ServerlessSecurityGroup
  VPCESecurityGroup:
    Value: !Ref VPCESecurityGroup
